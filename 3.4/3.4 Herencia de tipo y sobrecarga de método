-- Nota: Para probar este ejemplo tiene que haber ejecutado antes el 

-- Si existe el subtipo, hay que borrarlo primero para evitar el error:
-- ORA-02303: No se puede usar DROP o REPLACE para un tipo que tenga dependientes de tipo o tabla.
DROP TYPE oTipoEmpleadoTemporal;

-- Creación del supertipo base (padre): oTipoEmpleado
CREATE OR REPLACE TYPE oTipoEmpleado
AS OBJECT(pID      NUMBER           -- Atributo: Identificador del empleado.
         ,pNombre  VARCHAR2(50)     -- Atributo: Nombre del empleado.
         ,pSalario NUMBER           -- Atributo: Salario base (se usa para cálculo en el subtipo).
         ,pJefe    NUMBER           -- Atributo: ID del jefe.
         ,CONSTRUCTOR FUNCTION oTipoEmpleado -- Constructor con 3 parámetros iniciales.
             (pID      NUMBER
             ,pNombre  VARCHAR2
             ,pSalario NUMBER)
             RETURN SELF AS RESULT
         ,MEMBER PROCEDURE verEmpleado -- Declaración del método que será sobrescrito.
         ) NOT FINAL; -- Permite que otros tipos de objeto hereden de este (es la superclase).
/

-- Subtipo que hereda del supertipo (hijo): oTipoEmpleadoTemporal
CREATE OR REPLACE TYPE oTipoEmpleadoTemporal
    UNDER oTipoEmpleado -- Cláusula clave que establece la herencia de oTipoEmpleado.
    (pJornada INTEGER    -- Nuevo atributo específico del empleado temporal.
    ,CONSTRUCTOR FUNCTION oTipoEmpleadoTemporal -- Declaración del nuevo constructor.
        (pID      NUMBER
        ,pNombre  VARCHAR2
        ,pSalario NUMBER
        ,pJefe    NUMBER
        ,pJornada INTEGER) -- Incluye todos los atributos (heredados + nuevos).
        RETURN SELF AS RESULT
    ,OVERRIDING MEMBER PROCEDURE verEmpleado); -- Indica que este subtipo implementará su propia versión del método verEmpleado.
/

-- Implementación del cuerpo del tipo de objeto (TYPE BODY) para oTipoEmpleadoTemporal
CREATE OR REPLACE TYPE BODY oTipoEmpleadoTemporal AS
    
    -- Implementación del Constructor para el subtipo
    CONSTRUCTOR FUNCTION oTipoEmpleadoTemporal
        (pID      NUMBER
        ,pNombre  VARCHAR2
        ,pSalario NUMBER
        ,pJefe    NUMBER
        ,pJornada INTEGER)
        RETURN SELF AS RESULT
    IS
        BEGIN
            -- Asignación manual de los atributos heredados de oTipoEmpleado
            SELF.pID:=pID;
            SELF.pNombre:=pNombre;
            SELF.pSalario:=pSalario;
            SELF.pJefe:=pJefe;
            
            -- Asignación del atributo propio del subtipo
            SELF.pJornada:=pJornada;
            
            RETURN;
        END;

    -- Implementación del método sobrescrito (OVERRIDING)
    OVERRIDING MEMBER PROCEDURE verEmpleado
    AS
        BEGIN
            -- Mostrar atributos heredados (ID, Nombre)
            DBMS_OUTPUT.PUT_LINE('ID= '     ||SELF.pID);
            DBMS_OUTPUT.PUT_LINE('Nombre= ' ||SELF.pNombre);
            
            -- Mostrar el cálculo del salario prorrateado, que es la lógica nueva/sobrescrita.
            DBMS_OUTPUT.PUT_LINE('Salario prorrateado'
                                ||'('||SELF.pJornada||')');
            
            -- Cálculo: Salario Base * Jornada / 8 horas (asumiendo jornada completa).
            DBMS_OUTPUT.PUT_LINE('Salario= '
                                ||SELF.pSalario*SELF.pJornada/8);
            
            -- Mostrar el jefe si existe
            IF SELF.pJefe IS NOT NULL THEN
                DBMS_OUTPUT.PUT_LINE('Jefe= '||SELF.pJefe);
            END IF;
        END;
END;
/
