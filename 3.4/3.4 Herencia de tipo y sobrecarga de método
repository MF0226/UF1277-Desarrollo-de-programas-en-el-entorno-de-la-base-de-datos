-- Si existe el subtipo, hay que borrarlo primero para evitar el error:
-- ORA-02303: No se puede usar DROP o REPLACE para un tipo que tenga dependientes de tipo o tabla.
DROP TYPE oTipoEmpleadoTemporal;

-- Creación del supertipo base (padre): oTipoEmpleado
CREATE OR REPLACE TYPE oTipoEmpleado
AS OBJECT(pID      NUMBER           -- Atributo: Identificador del empleado.
         ,pNombre  VARCHAR2(50)     -- Atributo: Nombre del empleado.
         ,pSalario NUMBER           -- Atributo: Salario base (se usa para cálculo en el subtipo).
         ,pJefe    NUMBER           -- Atributo: ID del jefe.
         ,CONSTRUCTOR FUNCTION oTipoEmpleado -- Constructor con 3 parámetros iniciales.
             (pID      NUMBER
             ,pNombre  VARCHAR2
             ,pSalario NUMBER)
             RETURN SELF AS RESULT
         ,MEMBER PROCEDURE verEmpleado -- Declaración del método que será sobrescrito.
         ) NOT FINAL; -- Permite que otros tipos de objeto hereden de este (es la superclase).
/

-- Cuerpo del tipo
CREATE OR REPLACE TYPE BODY oTipoEmpleado AS -- Se crea o reemplaza el cuerpo (implementación) del Tipo de Objeto.
    
    -- Implementación del Constructor:
    CONSTRUCTOR FUNCTION oTipoEmpleado
        /* NOTA IMPORTANTE: 
        En el TYPE BODY, no se especifica el tamaño de los tipos de datos (e.g., VARCHAR2, no VARCHAR2(50)).
        */
        (pID      NUMBER
        ,pNombre  VARCHAR2
        ,pSalario NUMBER
        ,pJefe    NUMBER)
        RETURN SELF AS RESULT -- Debe coincidir con la declaración del tipo.
    IS
        BEGIN
            DBMS_OUTPUT.PUT_LINE('-- Constructor --');
            
            /* La palabra clave SELF hace referencia a la instancia del objeto 
            que se está creando o modificando. Asignamos los parámetros 
            de entrada (pID, pNombre, etc.) a los atributos del objeto (SELF.pID, SELF.pNombre, etc.). 
            */
            SELF.pID      :=pID;
            SELF.pNombre  :=pNombre;
            SELF.pSalario :=pSalario;
            SELF.pJefe    :=pJefe;
            
            RETURN; -- El constructor implícitamente devuelve SELF.
        END; -- Fin del Constructor

    -- Implementación del Procedimiento Miembro (Método):
    MEMBER PROCEDURE verEmpleado
    IS
        BEGIN
            -- Mostrar los atributos del objeto usando SELF.
            DBMS_OUTPUT.PUT_LINE('ID= '     ||SELF.pID);
            DBMS_OUTPUT.PUT_LINE('Nombre= ' ||SELF.pNombre);
            DBMS_OUTPUT.PUT_LINE('Salario=' ||SELF.pSalario);
            
            -- Lógica condicional: Solo muestra el jefe si el atributo no es nulo.
            IF SELF.pJefe IS NOT NULL THEN
                DBMS_OUTPUT.PUT_LINE('Jefe= '||SELF.pJefe);
            END IF;
        END; -- Fin del Procedimiento Miembro
        
END; -- Fin de la Implementación del Cuerpo del Tipo de Objeto
/

-- Subtipo que hereda del supertipo (hijo): oTipoEmpleadoTemporal
CREATE OR REPLACE TYPE oTipoEmpleadoTemporal
    UNDER oTipoEmpleado -- Cláusula clave que establece la herencia de oTipoEmpleado.
    (pJornada INTEGER    -- Nuevo atributo específico del empleado temporal.
    ,CONSTRUCTOR FUNCTION oTipoEmpleadoTemporal -- Declaración del nuevo constructor.
        (pID      NUMBER
        ,pNombre  VARCHAR2
        ,pSalario NUMBER
        ,pJefe    NUMBER
        ,pJornada INTEGER) -- Incluye todos los atributos (heredados + nuevos).
        RETURN SELF AS RESULT
    ,OVERRIDING MEMBER PROCEDURE verEmpleado); -- Indica que este subtipo implementará su propia versión del método verEmpleado.
/

-- Implementación del cuerpo del tipo de objeto (TYPE BODY) para oTipoEmpleadoTemporal
CREATE OR REPLACE TYPE BODY oTipoEmpleadoTemporal AS
    
    -- Implementación del Constructor para el subtipo
    CONSTRUCTOR FUNCTION oTipoEmpleadoTemporal
        (pID      NUMBER
        ,pNombre  VARCHAR2
        ,pSalario NUMBER
        ,pJefe    NUMBER
        ,pJornada INTEGER)
        RETURN SELF AS RESULT
    IS
        BEGIN
            -- Asignación manual de los atributos heredados de oTipoEmpleado
            SELF.pID:=pID;
            SELF.pNombre:=pNombre;
            SELF.pSalario:=pSalario;
            SELF.pJefe:=pJefe;
            
            -- Asignación del atributo propio del subtipo
            SELF.pJornada:=pJornada;
            
            RETURN;
        END;

    -- Implementación del método sobrescrito (OVERRIDING)
    OVERRIDING MEMBER PROCEDURE verEmpleado
    AS
        BEGIN
            -- Mostrar atributos heredados (ID, Nombre)
            DBMS_OUTPUT.PUT_LINE('ID= '     ||SELF.pID);
            DBMS_OUTPUT.PUT_LINE('Nombre= ' ||SELF.pNombre);
            
            -- Mostrar el cálculo del salario prorrateado, que es la lógica nueva/sobrescrita.
            DBMS_OUTPUT.PUT_LINE('Salario prorrateado'
                                ||'('||SELF.pJornada||')');
            
            -- Cálculo: Salario Base * Jornada / 8 horas (asumiendo jornada completa).
            DBMS_OUTPUT.PUT_LINE('Salario= '
                                ||SELF.pSalario*SELF.pJornada/8);
            
            -- Mostrar el jefe si existe
            IF SELF.pJefe IS NOT NULL THEN
                DBMS_OUTPUT.PUT_LINE('Jefe= '||SELF.pJefe);
            END IF;
        END;
END;
/
