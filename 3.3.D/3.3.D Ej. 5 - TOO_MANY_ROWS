SET SERVEROUTPUT ON

DECLARE
    -- Declaración de una variable de tipo registro
    -- para almacenar los datos de una fila de la tabla EMPLOYEES.
    rEmpleado EMPLOYEES%ROWTYPE;
BEGIN
    -- Bloque BEGIN principal.
    -- Contiene un bloque BEGIN anidado para el manejo local de la excepción.
    BEGIN -- Tratamiento local de la excepción (Bloque Interno)
        
        -- ERROR DE DISEÑO:
        -- Esta SELECT intenta devolver *TODAS* las filas de la tabla EMPLOYEES 
        -- y asignarlas a la única variable de registro 'rEmpleado'.
        -- Si la tabla tiene más de un empleado, lanza la excepción TOO_MANY_ROWS (ORA-01422).
        SELECT * INTO rEmpleado
        FROM EMPLOYEES;
        
    EXCEPTION
        -- Captura la excepción predefinida NO_DATA_FOUND (ORA-01403).
        WHEN NO_DATA_FOUND THEN 
            -- ESTE MANEJADOR ES IGNORADO:
            -- La excepción lanzada es TOO_MANY_ROWS (ORA-01422), por lo que
            -- esta cláusula (WHEN NO_DATA_FOUND) no coincide.
            DBMS_OUTPUT.PUT_LINE ('No hay datos.');
        
            -- La instrucción RAISE; no se ejecuta.
            -- El error TOO_MANY_ROWS no es capturado aquí y se propaga automáticamente.
            RAISE;
            
    END; -- Fin del bloque interno
    
    -- Esta línea NO se ejecuta, ya que la ejecución fue interrumpida por la excepción 
    -- TOO_MANY_ROWS no capturada en el bloque interno.
    DBMS_OUTPUT.PUT_LINE ('Terminación normal del bloque');
    
EXCEPTION
    -- Bloque de manejo de excepciones del bloque principal (Bloque Externo).
    -- Captura la excepción TOO_MANY_ROWS que se propagó desde el bloque interno.
    WHEN OTHERS THEN 
        -- Imprime un mensaje y el código/descripción del error capturado.
        -- Resultado esperado: ORA-01422: exact fetch returns more than requested number of rows.
        DBMS_OUTPUT.PUT_LINE ('Error :'||SQLERRM);
        
END;
/
